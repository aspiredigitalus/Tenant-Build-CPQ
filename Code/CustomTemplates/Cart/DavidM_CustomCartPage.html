@using WebSite.Controllers
<main class="w960 cart-width quote-page-container fiori3-cart-page-container fiori3-cart-tab-container">
    
    <div class="row cart" id="cartContainer" data-bind="css: { 'no-action-images': !cartActionsModel().displayImagesForCartActions() } ">
        <div class="row row-offcanvas row-offcanvas-left quote-page-main-container collapsed-actions-visible" data-bind="visible: isInitalized, css: { 'active': areActionsActive }" style="display: none;">
            <div class="clearfix cart-wrapper" data-bind="css: { 'cart-view-mode': isInViewMode }">
                
                <div class="clearfix"></div>
                @Html.PartialWithNameAsComment("Sections/Promotions")
                <scripting-messages params="quoteMessages: $root.quoteMessages"></scripting-messages>
                @Html.PartialWithNameAsComment("Sections/Notifications")
                @Html.PartialWithNameAsComment("Sections/InvalidAutocompleteNotification")
                <div class="cart-content fiori3-cart-content clearfix">
                    @Html.PartialWithNameAsComment("Sections/Tabs")
                    <div id="cartSectionsWrapper" class="cart-sections-wrapper">
                        @Html.PartialWithNameAsComment("Sections/Proposal")
                        @{
                            var i = 0;
                            IList<string> sections = CartController.GetSections();
                            while (i < sections.Count)
                            {
                                Html.RenderPartialWithNameAsComment("Sections/" + sections[i]);
                                i += 1;
                            }
                        }
                    </div>

                        <!-- Takes the place of a knockout if: statement -->
                        <div style="display:none" data-bind="attr: {title: subscribedResponse().then(resp=>{
										if(resp.data.PermissionGroup === 'nVent_Phase2_Filtered'){
                                        	$element.style.display = '';
                                        }
										$element.title = 'resp.data.Territory';
                                       	})}">
                            <h1 data-bind="attr: {title: subscribedResponse().then(resp=>{
                                            $element.innerHTML = resp.data.Territory;
                                            $element.title = 'Incompatible with your user or region.';
                                            })}">Temporary</h1>
                        </div>

                        <!-- Takes the place of a knockout ifnot: statement -->
                        <div data-bind="attr: {title: subscribedResponse().then(resp=>{
										if(resp.data.PermissionGroup === 'nVent_Phase2_Filtered'){
                                        	$element.style.display = 'none';
                                        }
										$element.title = 'resp.data.Territory';
                                       	})}">
                            <h1>Original Element</h1>
                        </div>

                    <div class="my-new-class">
        				<!-- ko stopBinding: true -->
        				<p id="exampleWidget" data-bind="text: customText"></p>
        				<!-- /ko -->
					</div>
                    @if (CartController.CanAccessCartDebugger())
                    {
                        @Html.PartialWithNameAsComment("Debugger")
                    }
                </div>
                @Html.Partial("~/Views/Favourites/AddToFavoritesDialogTemplate.cshtml")

                <!-- ko if: promosInfo.shouldShowPromotionsInfo -->
                @Html.PartialWithNameAsComment("/Views/Cart/Dialogs/PromotionDialogTemplate.cshtml")
                <!-- /ko -->
                <!-- ko with: filterEditor -->
                <div style="position: fixed; left: 0; right: 0; top: 0;bottom: 0"></div>
                <div id="filter-editor-content" class="quote-items-filter-editor fiori3-cart-filter slide-in-from-left" data-bind="affixTop: { disableScroll: true }">
                    <div class="quote-filter-header" style="border-bottom: 1px solid #ededed">
                        <h4 data-bind="text: $root.filtersLabel"></h4>
                        <span class="close-filter-editor">
                            <i tabindex="0" class="fa fa-times" data-bind="click: $parent.toggleFilterEditor, event: { keyup: function() { $parent.toggleFilterEditorOnEnter(event) } }, tooltip: { title: '@Translation.GetJS("Msg.Close")' }, attr: { 'aria-label': '@Translation.GetJS("Msg.Close")' }"></i>
                        </span>
                    </div>
                    <div id="quoteFilterContainer" class="quote-list-editors cpq-scroll" data-bind="foreach: filters">
                        <div data-bind="template: 'Filter_' + template" class="fiori3-input-group"></div>
                    </div>
                    <div class="quote-list-tab-footer">
                        <button class="btn btn-primary fiori3-btn-primary" data-bind="click: applyFilters, enable: actionEnabled(), executeOnEnter: function() { applyFilters(); }">@Translation.Get("QuoteList.ApplyFilter")</button>
                        <button class="btn btn-tertiary fiori3-btn-tertiary" data-bind="click: $parent.toggleFilterEditor, event: { keyup: function() { $parent.toggleFilterEditorOnEnter(event) } }">@Translation.Get("QuoteList.Cancel")</button>
                    </div>
                </div>
                <!-- /ko -->
            </div>
        </div>
    </div>
</main>

@Html.PartialWithNameAsComment("Templates/CellTemplates")
@Html.PartialWithNameAsComment("Templates/QuoteFilterTemplates")
@Html.PartialWithNameAsComment("Templates/TotalsTemplate")
@Html.PartialWithNameAsComment("/Views/CartList/Dialogs/ReassignCartDialogTemplate.cshtml")
@Html.PartialWithNameAsComment("/Views/Cart/Dialogs/PricebookMissingForMarketDialogTemplate.cshtml")
@Html.PartialWithNameAsComment("/Views/Cart/Dialogs/CreatePartialOrderDialogTemplate.cshtml")
@Html.PartialWithNameAsComment("Dialogs/UpgradeProductsProgressBarTemplate")
@Html.PartialWithNameAsComment("SliderTemplate")
<script>
    async function subscribedResponse(){
        if(Object.keys(userData).length===0){
            const data = await new Promise((resolve) => {
                cpq.events.sub("PopulateUserData",function(response){
                	console.log("Subscribe: ", response);
                	resolve(response);
            	});
            });
            console.log("After await: ", data);
            return {"data": data };
        } else{
        	return {"data": userData};
        }
    }
    cpq.ready( function(){
        var model = {
            customText: ko.observable("This is my Text, and I like it!")
        }
        ko.bindingHandlers.stopBinding = {
    		init: function() {
        		return { controlsDescendantBindings: true };
    		}
		};

		ko.virtualElements.allowedBindings.stopBinding = true;

        ko.applyBindings(model, document.getElementById('exampleWidget'));
    });
</script>